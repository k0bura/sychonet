---
interface Props {
  title: string;
  description?: string;
}

const { title, description } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    {description && <meta name="description" content={description} />}
    <title>{title}</title>
  </head>
  <body>
    <div class="phone-wall">
      <pre>{`
▒▒▒ ACCESS DENIED ▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒

> TERMINAL SIZE ERROR
> INSUFFICIENT COLUMN WIDTH
>
> Are you seriously trying to view
> this site on a phone? In ${new Date().getFullYear()}?
>
> This site was built for 80 columns.
> Your device has the screen real
> estate of a postage stamp.
>
> Go find a real computer.
> Preferably one that weighs at
> least 5kg and has a CRT.
>
> NO CARRIER
`}</pre>
    </div>
    <main>
      <slot />
    </main>
    <footer>
      <p>&copy; {new Date().getFullYear()} jeff | <a href={`${import.meta.env.BASE_URL}`}>~/sychonet</a></p>
    </footer>
    <div class="lightbox" id="lightbox">
      <img id="lightbox-img" src="" alt="" />
      <span class="lightbox-hint">click or ESC to close</span>
    </div>
  </body>
</html>

<script>
  const lightbox = document.getElementById('lightbox')!;
  const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;

  document.querySelectorAll('article img').forEach((img) => {
    img.addEventListener('click', () => {
      lightboxImg.src = (img as HTMLImageElement).src;
      lightboxImg.alt = (img as HTMLImageElement).alt;
      lightbox.classList.add('active');
    });
  });

  lightbox.addEventListener('click', () => {
    lightbox.classList.remove('active');
  });

  document.addEventListener('keydown', (e) => {
    if (e.ctrlKey || e.altKey || e.metaKey) return;
    const tag = (e.target as HTMLElement).tagName;
    if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT') return;

    if (e.key === 'Escape') {
      if (lightbox.classList.contains('active')) {
        e.preventDefault();
        lightbox.classList.remove('active');
        return;
      }
      e.preventDefault();
      window.location.href = '/';
      return;
    }

    const key = e.key.toUpperCase();

    if (window.location.pathname === '/' || window.location.pathname === '/index.html') {
      const routes: Record<string, string> = {
        P: '/projects/',
        A: '/about/',
        L: '/links/',
        N: '/news/',
        F: '/files/',
        C: '/contact/',
      };
      if (routes[key]) {
        e.preventDefault();
        window.location.href = routes[key];
      }
    }
  });
</script>

<style is:global>
  @font-face {
    font-family: 'IBM Plex Mono';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url('/fonts/ibm-plex-mono-regular.woff2') format('woff2');
  }

  @font-face {
    font-family: 'IBM Plex Mono';
    font-style: normal;
    font-weight: 700;
    font-display: swap;
    src: url('/fonts/ibm-plex-mono-bold.woff2') format('woff2');
  }

  body {
    font-family: 'IBM Plex Mono', monospace;
    background: #111;
    color: #c0c0c0;
    max-width: 80ch;
    margin: 0 auto;
    padding: 2rem 1rem;
    line-height: 1.6;
  }

  a {
    color: #ffcc00;
  }

  a:visited {
    color: #cc9900;
  }

  a:hover {
    color: #111;
    background: #ffcc00;
  }

  h1, h2, h3, h4 {
    color: #ffcc00;
    font-weight: normal;
  }

  code {
    background: #1a1a1a;
    padding: 0.2em 0.4em;
    font-size: 0.95em;
  }

  pre {
    font-family: 'IBM Plex Mono', monospace;
    background: #1a1a1a !important;
    padding: 1rem;
    overflow-x: hidden;
    border: 1px solid #332b00;
  }

  pre code {
    background: none;
    padding: 0;
  }

  hr {
    border: none;
    border-top: 1px dashed #332b00;
    margin: 1.5rem 0;
  }

  header a {
    text-decoration: none;
    font-size: 1.2em;
  }

  footer {
    color: #665200;
    font-size: 0.9em;
  }

  ul {
    list-style: none;
    padding: 0;
  }

  article ul {
    padding-left: 2rem;
  }

  article ul li {
    position: relative;
  }

  article ul li::before {
    content: '>';
    color: #665200;
    position: absolute;
    left: -1.5rem;
  }

  article ol {
    padding-left: 1.5rem;
    color: #665200;
  }

  article ol li {
    padding-left: 0.3rem;
  }

  article ol li > * {
    color: #c0c0c0;
  }

  article li {
    margin: 0.3rem 0;
  }

  table {
    border-collapse: collapse;
    width: 100%;
    margin: 1rem 0;
    font-size: 0.85em;
  }

  th {
    color: #ffcc00;
    text-align: left;
    border-bottom: 1px solid #665200;
    padding: 0.4rem 0.6rem;
  }

  td {
    border-bottom: 1px solid #1a1a1a;
    padding: 0.3rem 0.6rem;
  }

  tr:hover td {
    background: #1a1a1a;
  }

  article img {
    max-width: 100%;
    height: auto;
    max-height: 300px;
    object-fit: contain;
    cursor: zoom-in;
    border: 1px solid #332b00;
    display: block;
    margin: 0.5rem 0;
  }

  .lightbox {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.92);
    z-index: 1000;
    cursor: zoom-out;
    justify-content: center;
    align-items: center;
  }

  .lightbox.active {
    display: flex;
  }

  .lightbox img {
    max-width: 95vw;
    max-height: 95vh;
    object-fit: contain;
    border: 1px solid #332b00;
  }

  .lightbox-hint {
    position: fixed;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    color: #665200;
    font-size: 0.8em;
    z-index: 1001;
  }

  .phone-wall {
    display: none;
  }

  @media (max-width: 600px) {
    .phone-wall {
      display: block;
    }

    .phone-wall pre {
      color: #ff4444;
      background: none !important;
      border: none !important;
      padding: 0 !important;
      white-space: pre-wrap;
    }

    main, footer {
      display: none;
    }
  }
</style>
